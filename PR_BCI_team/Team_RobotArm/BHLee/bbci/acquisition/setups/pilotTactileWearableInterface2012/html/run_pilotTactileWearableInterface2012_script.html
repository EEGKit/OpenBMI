
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">
<html xmlns:mwsh="http://www.mathworks.com/namespace/mcode/v1/syntaxhighlight.dtd">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
      <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      -->
      <title>run_pilotTactileWearableInterface2012_script</title>
      <meta name="generator" content="MATLAB 7.5">
      <meta name="date" content="2012-06-14">
      <meta name="m-file" content="run_pilotTactileWearableInterface2012_script"><style>

body {
  background-color: white;
  margin:10px;
}

h1 {
  color: #990000; 
  font-size: x-large;
}

h2 {
  color: #990000;
  font-size: medium;
}

/* Make the text shrink to fit narrow windows, but not stretch too far in 
wide windows. */ 
p,h1,h2,div.content div {
  max-width: 600px;
  /* Hack for IE6 */
  width: auto !important; width: 600px;
}

pre.codeinput {
  background: #EEEEEE;
  padding: 10px;
}
@media print {
  pre.codeinput {word-wrap:break-word; width:100%;}
} 

span.keyword {color: #0000FF}
span.comment {color: #228B22}
span.string {color: #A020F0}
span.untermstring {color: #B20000}
span.syscmd {color: #B28C00}

pre.codeoutput {
  color: #666666;
  padding: 10px;
}

pre.error {
  color: red;
}

p.footer {
  text-align: right;
  font-size: xx-small;
  font-weight: lighter;
  font-style: italic;
  color: gray;
}

  </style></head>
   <body>
      <div class="content">
         <h2>Contents</h2>
         <div>
            <ul>
               <li><a href="#2">For tactile communication</a></li>
               <li><a href="#3">preperation</a></li>
               <li><a href="#4">Accostume to tactile stimuli</a></li>
               <li><a href="#5">Baseline recording of motor responses</a></li>
               <li><a href="#6">Practice trials</a></li>
               <li><a href="#7">main experimental loop</a></li>
               <li><a href="#8">extra condition</a></li>
               <li><a href="#9">--- - --- Session finished</a></li>
               <li><a href="#10">Leftovers</a></li>
               <li><a href="#11">----- Oddball - 4 different ISIs, randomized order</a></li>
               <li><a href="#12">Oddball - Practice</a></li>
               <li><a href="#13">Oddball - Recording</a></li>
            </ul>
         </div><pre class="codeinput"><span class="comment">%declareglobals</span>
<span class="keyword">global</span> ontime; <span class="keyword">global</span> offtime;
<span class="keyword">global</span> conversion_tactors_LR; <span class="keyword">global</span> conversion_tactors_RL;
<span class="keyword">global</span> socke; <span class="keyword">global</span> nTactors;
<span class="keyword">global</span> targets_rounds_designated;
<span class="keyword">global</span> VP_NUMBER;
<span class="keyword">global</span> orders_stim2resp;
</pre><h2>For tactile communication<a name="2"></a></h2>
         <p>Init UDP connection</p><pre class="codeinput">input (<span class="string">'Start VestByUDP. Press Enter to continue'</span>)
path(path, [BCI_DIR <span class="string">'import/tcp_udp_ip'</span>]); socke= pnet(<span class="string">'udpsocket'</span>, 1111); <span class="keyword">if</span> socke==-1,
   error(<span class="string">'udp communication failed'</span>);
<span class="keyword">end</span>
pnet(socke, <span class="string">'udpconnect'</span>,<span class="string">'127.0.0.1'</span>, 55555);
nTactors=[]; <span class="comment">%?!? nTactors being.. the total amount to control?</span>
</pre><pre class="codeoutput">Error using ==&gt; input
Cannot call INPUT from EVALC.</pre><h2>preperation<a name="3"></a></h2><pre class="codeinput">ontime=0.2;
offtime=0.15;
pp_index_nr=mod((VP_NUMBER-1),6)+1;
practice_tactor_nr=0;

conversion_tactors_LR=[27:-1:24, 35:-1:33]; <span class="comment">%From left to right</span>
conversion_tactors_RL=[33:35, 24:27]; <span class="comment">%From right to left</span>

target_sequence=[1:7];
<span class="comment">% load_ExpFiles_Path= 'D:\WERK\Wearable tactile interface project\3_ExperimentPreparation\Exp_Files_Load';</span>
load_ExpFiles_Path=<span class="string">'C:\DATA\WearableTactileInterface\1_DATA\Exp_Files_Load'</span>; <span class="comment">%'D:\Exp_Files_Load';</span>
cd (load_ExpFiles_Path)
load <span class="string">conditions_order_balanced_list</span>
load <span class="string">condition_stimuli_order</span>;

<span class="comment">% Conditions/order</span>
condition_tags= {<span class="string">'Cond1'</span>,<span class="string">'Cond2'</span>,<span class="string">'Cond3'</span>};
block_tags= {<span class="string">'Block1'</span>,<span class="string">'Block2'</span>, <span class="string">'Block3'</span>};
<span class="comment">% order= perms(1:length(condition_tags));</span>
<span class="comment">% conditionsOrder= uint8(order(1+mod(VP_NUMBER-1, size(order,1)),:));</span>
condition_names={<span class="string">'RandomOrder'</span>, <span class="string">'SemiRandomOrder'</span>, <span class="string">'FixedOrder'</span>};
tekst_block_instruction(1)={<span class="string">'Attend to targets mentally, no motor response is required now.'</span>};
tekst_block_instruction(2)={<span class="string">'Attend to targets mentally, no motor response is required now.'</span>};
tekst_block_instruction(3)={<span class="string">'Now motor response is required too. Respond to targets as fast and accurate as possible, by pressing the button.'</span>};

tekst_condition_instruction(1)={<span class="string">'Stimuli are presented in random order.'</span>};
tekst_condition_instruction(2)={<span class="string">'Stimuli are presented in (semi)random order, but two sequential stimuli are always spatially proximate.'</span>};
tekst_condition_instruction(3)={<span class="string">'Stimuli are presented in a fixed and spatially adjacent order, from right to left and back.'</span>};
tekst_condition_instruction_general=<span class="string">'Keep spatial attention always to the current target location.'</span>;
</pre><h2>Accostume to tactile stimuli<a name="4"></a></h2>
         <p>no button responses or EEG recording, just stimulation</p><pre class="codeinput">ActivateTactors;
</pre><h2>Baseline recording of motor responses<a name="5"></a></h2><pre class="codeinput">sufficient_responses=0;
<span class="keyword">while</span> sufficient_responses==0;

    orders_stim2resp_all= [perms(1:7)];
    orders_stim2resp=[];
    <span class="keyword">for</span> rand_rep=1:5
        orders_stim2resp_ind=1+round(rand*(5040-1));
        orders_stim2resp=[orders_stim2resp, orders_stim2resp_all(orders_stim2resp_ind,:)];
    <span class="keyword">end</span>

    filename_baserecording=bvr_startrecording([<span class="string">'tactile_'</span> <span class="string">'MotorRespBaseline'</span>], <span class="string">'impedances'</span>,0); <span class="comment">%</span>

    MotorRespBaseline
    bvr_sendcommand(<span class="string">'stoprecording'</span>);

    <span class="comment">%check sufficient responses</span>

    [sufficient_responses, nr_responses, nr_pres_stimuli]=CheckResponses(filename_baserecording);

    <span class="keyword">if</span> sufficient_responses==0
        fprintf (<span class="string">'Insuffient number of responses; there were %s responses.\n'</span>, int2str(nr_responses))
    <span class="keyword">elseif</span> sufficient_responses==1
        fprintf (<span class="string">'Suffient number of responses! There were %s responses.\n'</span>, int2str(nr_responses))
    <span class="keyword">end</span>
<span class="keyword">end</span>
fprintf (<span class="string">'BaselineRecording was succesful. Press enter to continue.\n'</span>); input(<span class="string">''</span>);
</pre><h2>Practice trials<a name="6"></a></h2>
         <h2>main experimental loop<a name="7"></a></h2><pre class="codeinput"><span class="keyword">for</span> block_nr=1:3; <span class="comment">%lster integreren</span>
    <span class="keyword">if</span> block_nr~=1
        fprintf (<span class="string">'Take a break, relax and enjoy some ''Probandenfutter''!\n\n'</span>)
    <span class="keyword">end</span>

    fprintf (<span class="string">'This is block %s.\n\n%s.\n'</span>,  num2str(block_nr), char(tekst_block_instruction(block_nr)) )
    fprintf (<span class="string">'Press enter when you are ready to start block %s.\n'</span>, num2str(block_nr));  input(<span class="string">''</span>);
    fprintf (<span class="string">'Block %s is starting.. \n\n'</span>, num2str(block_nr))
    balanced_order=eval([<span class="string">'conditions_order_balanced_list'</span>, num2str(block_nr)]);
    balanced_order_ind=balanced_order(pp_index_nr,:);
    targets_rounds_designated=conversion_tactors_RL(target_sequence);

    <span class="keyword">for</span> balanced_cond_nr= balanced_order_ind <span class="comment">%conditionsOrder,</span>
      fprintf ([num2str(balanced_order_ind) <span class="string">'\n'</span>]) <span class="comment">%info for during experiment-file creation&gt; to comment</span>
      fprintf (<span class="string">'This is condition %s.\n\n%s\n%s\n'</span>,  char(condition_names(balanced_cond_nr)), char(tekst_condition_instruction(balanced_cond_nr)), tekst_condition_instruction_general )
      fprintf (<span class="string">'Do you have questions? Press enter when you are ready to start the recording.\n'</span>); input(<span class="string">''</span>);
      bvr_startrecording([<span class="string">'tactile_'</span> condition_names{balanced_cond_nr} <span class="string">'_'</span> block_tags{block_nr}], <span class="string">'impedances'</span>,0); <span class="comment">%</span>
      <span class="keyword">switch</span>(condition_tags{balanced_cond_nr}),
        <span class="keyword">case</span> <span class="string">'Cond1'</span>,
<span class="comment">%           ConditionControl(Random_Order_LR, Random_Order_RL);</span>
          Order_LR=Random_Order_LR;
          Order_RL=Random_Order_RL;
        <span class="keyword">case</span> <span class="string">'Cond2'</span>,
<span class="comment">%           ConditionFixed (Fixed_Order_LR, Fixed_Order_RL);</span>
          Order_LR=SemiRandom_Order_LR;
          Order_RL=SemiRandom_Order_RL;
        <span class="keyword">case</span> <span class="string">'Cond3'</span>,
<span class="comment">%           ConditionSemiRandom(SemiRandom_Order_LR, SemiRandom_Order_RL);</span>
          Order_LR=Fixed_Order_LR;
          Order_RL=Fixed_Order_RL;
      <span class="keyword">end</span>
      ConditionGeneral(Order_LR, Order_RL)
      bvr_sendcommand(<span class="string">'stoprecording'</span>);
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>extra condition<a name="8"></a></h2><pre class="codeinput">extra_round=input(<span class="string">'Do you want to do an extra condition? Condition is Fast Fixed.\n'</span>);

extra_round_wait=0;

<span class="keyword">while</span> extra_round_wait==0;
    <span class="keyword">if</span> strcmp(extra_round, <span class="string">'y'</span>)==1
<span class="comment">%         ontime=0.15;</span>
        offtime=0;
        extra_round_wait=1;
        fprintf (<span class="string">'This is condition Fast Fixed.\n\n'</span> )
        fprintf (<span class="string">'Do you have questions? Press enter when you are ready to start the recording.\n'</span>); input(<span class="string">''</span>);
        bvr_startrecording([<span class="string">'tactile_'</span> <span class="string">'FastFixed'</span> <span class="string">'_'</span> ], <span class="string">'impedances'</span>,0); <span class="comment">%</span>
        Order_LR=Fixed_Order_LR;
        Order_RL=Fixed_Order_RL;
        ConditionGeneral(Order_LR, Order_RL)
        bvr_sendcommand(<span class="string">'stoprecording'</span>);
    <span class="keyword">elseif</span> strcmp(extra_round, <span class="string">'n'</span>)==1
        extra_round_wait=1;
        fprintf (<span class="string">'This was the experiment. Thank you for participating!\n'</span>)
    <span class="keyword">else</span>
       fprintf (<span class="string">'This was the experiment. Thank you for participating!\n'</span>)
    <span class="keyword">end</span>
<span class="keyword">end</span>
</pre><h2>--- - --- Session finished<a name="9"></a></h2><pre class="codeinput">acq_vpcounter(session_name, <span class="string">'close'</span>);
fprintf(<span class="string">'Session %s finished.\n'</span>, session_name);
</pre><h2>Leftovers<a name="10"></a></h2>
         <h2>----- Oddball - 4 different ISIs, randomized order<a name="11"></a></h2>
         <h2>Oddball - Practice<a name="12"></a></h2>
         <p>pyff('init', 'VisualOddballVE'); pause(.5); pyff('load_settings', ODDBALL_file); pyff('setint','nTrials',10); stimutil_waitForInput('msg_next','to
            start Oddball practice.'); pyff('play'); stimutil_waitForMarker(RUN_END); fprintf('Oddball practice finished.\n') pyff('quit');
         </p>
         <h2>Oddball - Recording<a name="13"></a></h2>
         <p>pyff('init', 'VisualOddballVE'); pause(.5); pyff('load_settings', ODDBALL_file); stimutil_waitForInput('msg_next','to start
            Oddball recording.'); pyff('play', 'basename', 'Oddball', 'impedances', 0); stimutil_waitForMarker(RUN_END); fprintf('Oddball
            recording finished.\n') pyff('quit'); fprintf('Press <a href="RETURN">RETURN</a> to continue.\n'); pause;
         </p>
         <p class="footer"><br>
            Published with MATLAB&reg; 7.5<br></p>
      </div>
      <!--
##### SOURCE BEGIN #####

%declareglobals
global ontime; global offtime;
global conversion_tactors_LR; global conversion_tactors_RL;
global socke; global nTactors;
global targets_rounds_designated;
global VP_NUMBER;
global orders_stim2resp;


%% For tactile communication
% Init UDP connection
input ('Start VestByUDP. Press Enter to continue')
path(path, [BCI_DIR 'import/tcp_udp_ip']); socke= pnet('udpsocket', 1111); if socke==-1,
   error('udp communication failed');
end
pnet(socke, 'udpconnect','127.0.0.1', 55555);
nTactors=[]; %?!? nTactors being.. the total amount to control?

%% preperation
ontime=0.2;
offtime=0.15; 
pp_index_nr=mod((VP_NUMBER-1),6)+1;
practice_tactor_nr=0;

conversion_tactors_LR=[27:-1:24, 35:-1:33]; %From left to right
conversion_tactors_RL=[33:35, 24:27]; %From right to left

target_sequence=[1:7];
% load_ExpFiles_Path= 'D:\WERK\Wearable tactile interface project\3_ExperimentPreparation\Exp_Files_Load';
load_ExpFiles_Path='C:\DATA\WearableTactileInterface\1_DATA\Exp_Files_Load'; %'D:\Exp_Files_Load';
cd (load_ExpFiles_Path)
load conditions_order_balanced_list
load condition_stimuli_order;

% Conditions/order
condition_tags= {'Cond1','Cond2','Cond3'};
block_tags= {'Block1','Block2', 'Block3'};
% order= perms(1:length(condition_tags));
% conditionsOrder= uint8(order(1+mod(VP_NUMBER-1, size(order,1)),:));
condition_names={'RandomOrder', 'SemiRandomOrder', 'FixedOrder'};
tekst_block_instruction(1)={'Attend to targets mentally, no motor response is required now.'};
tekst_block_instruction(2)={'Attend to targets mentally, no motor response is required now.'};
tekst_block_instruction(3)={'Now motor response is required too. Respond to targets as fast and accurate as possible, by pressing the button.'};

tekst_condition_instruction(1)={'Stimuli are presented in random order.'};
tekst_condition_instruction(2)={'Stimuli are presented in (semi)random order, but two sequential stimuli are always spatially proximate.'};
tekst_condition_instruction(3)={'Stimuli are presented in a fixed and spatially adjacent order, from right to left and back.'};
tekst_condition_instruction_general='Keep spatial attention always to the current target location.';


%% Accostume to tactile stimuli
% no button responses or EEG recording, just stimulation
ActivateTactors; 

%% Baseline recording of motor responses
sufficient_responses=0;
while sufficient_responses==0;
    
    orders_stim2resp_all= [perms(1:7)];
    orders_stim2resp=[];
    for rand_rep=1:5
        orders_stim2resp_ind=1+round(rand*(5040-1));
        orders_stim2resp=[orders_stim2resp, orders_stim2resp_all(orders_stim2resp_ind,:)];  
    end

    filename_baserecording=bvr_startrecording(['tactile_' 'MotorRespBaseline'], 'impedances',0); %

    MotorRespBaseline
    bvr_sendcommand('stoprecording');

    %check sufficient responses

    [sufficient_responses, nr_responses, nr_pres_stimuli]=CheckResponses(filename_baserecording);

    if sufficient_responses==0
        fprintf ('Insuffient number of responses; there were %s responses.\n', int2str(nr_responses))
    elseif sufficient_responses==1
        fprintf ('Suffient number of responses! There were %s responses.\n', int2str(nr_responses))
    end
end
fprintf ('BaselineRecording was succesful. Press enter to continue.\n'); input('');


%% Practice trials


%% main experimental loop
for block_nr=1:3; %lster integreren
    if block_nr~=1
        fprintf ('Take a break, relax and enjoy some ''Probandenfutter''!\n\n')
    end
    
    fprintf ('This is block %s.\n\n%s.\n',  num2str(block_nr), char(tekst_block_instruction(block_nr)) )     
    fprintf ('Press enter when you are ready to start block %s.\n', num2str(block_nr));  input('');
    fprintf ('Block %s is starting.. \n\n', num2str(block_nr))   
    balanced_order=eval(['conditions_order_balanced_list', num2str(block_nr)]); 
    balanced_order_ind=balanced_order(pp_index_nr,:); 
    targets_rounds_designated=conversion_tactors_RL(target_sequence);
    
    for balanced_cond_nr= balanced_order_ind %conditionsOrder,
      fprintf ([num2str(balanced_order_ind) '\n']) %info for during experiment-file creation> to comment
      fprintf ('This is condition %s.\n\n%s\n%s\n',  char(condition_names(balanced_cond_nr)), char(tekst_condition_instruction(balanced_cond_nr)), tekst_condition_instruction_general )   
      fprintf ('Do you have questions? Press enter when you are ready to start the recording.\n'); input('');
      bvr_startrecording(['tactile_' condition_names{balanced_cond_nr} '_' block_tags{block_nr}], 'impedances',0); %
      switch(condition_tags{balanced_cond_nr}),
        case 'Cond1',
%           ConditionControl(Random_Order_LR, Random_Order_RL);
          Order_LR=Random_Order_LR;
          Order_RL=Random_Order_RL;
        case 'Cond2',
%           ConditionFixed (Fixed_Order_LR, Fixed_Order_RL);
          Order_LR=SemiRandom_Order_LR; 
          Order_RL=SemiRandom_Order_RL;
        case 'Cond3',
%           ConditionSemiRandom(SemiRandom_Order_LR, SemiRandom_Order_RL);
          Order_LR=Fixed_Order_LR;
          Order_RL=Fixed_Order_RL;
      end
      ConditionGeneral(Order_LR, Order_RL)
      bvr_sendcommand('stoprecording');
    end  
end

%% extra condition

extra_round=input('Do you want to do an extra condition? Condition is Fast Fixed.\n');

extra_round_wait=0;

while extra_round_wait==0;
    if strcmp(extra_round, 'y')==1
%         ontime=0.15;
        offtime=0; 
        extra_round_wait=1;
        fprintf ('This is condition Fast Fixed.\n\n' )   
        fprintf ('Do you have questions? Press enter when you are ready to start the recording.\n'); input('');
        bvr_startrecording(['tactile_' 'FastFixed' '_' ], 'impedances',0); %
        Order_LR=Fixed_Order_LR;
        Order_RL=Fixed_Order_RL;
        ConditionGeneral(Order_LR, Order_RL)
        bvr_sendcommand('stoprecording');
    elseif strcmp(extra_round, 'n')==1
        extra_round_wait=1;
        fprintf ('This was the experiment. Thank you for participating!\n')
    else
       fprintf ('This was the experiment. Thank you for participating!\n')
    end
end


%% REPLACE_WITH_DASH_DASH- - REPLACE_WITH_DASH_DASH- Session finished

acq_vpcounter(session_name, 'close');
fprintf('Session %s finished.\n', session_name);











  
%% Leftovers



%% REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH- Oddball - 4 different ISIs, randomized order
%


%% Oddball - Practice
% pyff('init', 'VisualOddballVE'); pause(.5);
% pyff('load_settings', ODDBALL_file);
% pyff('setint','nTrials',10);
% stimutil_waitForInput('msg_next','to start Oddball practice.');
% pyff('play');
% stimutil_waitForMarker(RUN_END);
% fprintf('Oddball practice finished.\n')
% pyff('quit');
% 
%% Oddball - Recording
% pyff('init', 'VisualOddballVE'); pause(.5);
% pyff('load_settings', ODDBALL_file);
% stimutil_waitForInput('msg_next','to start Oddball recording.');
% pyff('play', 'basename', 'Oddball', 'impedances', 0);
% stimutil_waitForMarker(RUN_END);
% fprintf('Oddball recording finished.\n')
% pyff('quit');
% fprintf('Press <RETURN> to continue.\n'); pause;


##### SOURCE END #####
-->
   </body>
</html>