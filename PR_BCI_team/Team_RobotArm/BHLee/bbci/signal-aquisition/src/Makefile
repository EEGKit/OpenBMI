
#
# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make check  - makes everything and runs the built sample test.
#   make clean  - removes all files generated by make.


################  OS DEPENDANT STUFF #####################################
RM = rm


#################  EEG STUFF #############################

AMP_SRC = AmplifierConfig.cpp  EEGHeader.cpp EEGData.cpp Amplifier_BrainAmp.cpp Amplifier_File.cpp Amplifier_GTEC.cpp  EEGAccess.cpp
OBJ = ${AMP_SRC:.cpp=.o}
module = EEGAccess
OUTPUT_DIR = ../build
BOOST_DIR = "C:/Program Files/boost/boost_1_40/"




############ COMPILER STUFF ################################

GCC = g++

# Flags passed to the preprocessor.
CPPFLAGS += -I $(BOOST_DIR)

# Flags passed to the C++ compiler.
CFLAGS += -Wall -g


# -- for test compilation
# Flags passed to the preprocessor.
T_CPPFLAGS += -I $(FUSED_GTEST_DIR) 
T_LIBS += -L. -lEEGAccess
# Flags passed to the C++ compiler.
T_CXXFLAGS += -g



################# MAKE ##################################


all : lib

check : lib

clean :
	$(RM) -f *.o *.d *.a
	
	$(RM) -f $(OUTPUT_DIR)/*.dll 
	$(RM) -f $(OUTPUT_DIR)/*.eeg
	$(RM) -f $(OUTPUT_DIR)/*.exe 
	echo Clean Done
	

lib : ${OBJ}
	ar rc libEEGAccess.a $(OBJ)
	

ifeq "$(MAKECMDGOALS)" "lib"

	include	$(OBJ:.o=.d)

endif


# $(call make-depend,source-file,object-file,depend-file)

define make-depend
	$(GCC) -MM \
	-MF $3         \
	-MP            \
	-MT $2         \
	$(CFLAGS)      \
	$(CPPFLAGS)    \
	$(TARGET_ARCH) \
	$1 
	

endef


%.o: %.cpp
	$(call make-depend,$<,$@,$(subst .o,.d,$@))
	$(GCC) $(CFLAGS) $(CPPFLAGS) -c $< -o $@ 
